# DO NOT EDIT THIS FILE, it is auto-generated!
from jubladb_api.core import base_client
import typing
import datetime

{% for entity in entities %}
from jubladb_api.generated.entities.{{ entity.name_singular }} import {{ entity.name_singular | snake_case_to_pascal_case }}
{% endfor %}

# @formatter:off

{% for entity in entities %}
{% with class_name=entity.name_singular|snake_case_to_pascal_case %}
{% if entity.allowed_operations|length > 0 %}
{% if entity.includeable|length > 0 %}
_{{ class_name }}_Include = typing.Literal[
{% for inc in entity.includeable %}
    "{{ inc }}",
{% endfor %}]
{% endif %}
{% if entity|entity_has_sortable_attributes > 0 %}
_{{ class_name }}_Sort = typing.Literal[
{% for attr in entity.attributes %}
{% if attr.sortable %}
    "{{ attr.name }}_asc",
{% endif %}
{% endfor %}
{% for attr in entity.attributes %}
{% if attr.sortable %}
    "{{ attr.name }}_desc",
{% endif %}
{% endfor %}
]
{% endif %}
{% endif %}
{% endwith %}
{% endfor %}


class Client(base_client.BaseClient):

    def __init__(self, url: str, api_key: str):
        super().__init__(url, {"{{ api_key_header }}": api_key})

    {% for entity in entities %}
    {% with class_name=entity.name_singular|snake_case_to_pascal_case %}
    {% for op in entity.allowed_operations %}
    {% if op.name == "GetList" %}
    def get_{{ entity.name_plural }}_list(self,
                            {% if entity.includeable|length > 0 %}
                                          include: list[_{{ class_name }}_Include],
                            {% endif %}
                            {% if entity|entity_has_sortable_attributes %}
                                          sort: list[_{{ class_name }}_Sort],
                            {% endif %}
                            {% for attr in entity.attributes %}
                            {% for ft in attr.filter_types %}
                            filter_{{ attr.name }}_{{ ft }}: {{ attr.type_|attribute_type_to_python_type }},
                            {% endfor %}
                            {% endfor %}
                            ) -> list[{{ class_name }}]:
        filters = [
            {% for attr in entity.attributes %}
            {% for ft in attr.filter_types %}
            ("{{ attr.name }}", "{{ ft }}", filter_{{ attr.name }}_{{ ft }}),
            {% endfor %}
            {% endfor %}
        ]
        filters = [f for f in filters if f[2] is not None]
        json_response = self._request_list(
            "{{ entity.name_singular }}",

            {% if entity|entity_has_sortable_attributes %}
            sort,
            {% else %}
            [],
            {% endif %}

            {% if entity.includeable|length > 0 %}
            include,
            {% else %}
            [],
            {% endif %}

            filters)
        return [{{ class_name }}.from_json(data_obj) for data_obj in json_response["data"]]
        # todo return included too
    {% endif %}
    {% if op.name == "GetSingle" %}
    def get_{{ entity.name_singular }}(self,
            id_: int,
            {% if entity.includeable|length > 0 %}
            include: list[_{{ class_name }}_Include],
            {% endif %}
                    ) -> {{ class_name }}:
        json_response = self._request_single_get("{{ entity.name_singular }}", id_, include)
        return {{ class_name }}.from_json(json_response["data"])
        # todo return included too
    {% endif %}
    {% endfor %}
    {% endwith %}
    {% endfor %}
# @formatter:on

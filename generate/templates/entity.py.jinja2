# DO NOT EDIT THIS FILE, it is auto-generated!
import jubladb_api.core.metamodel_classes
import jubladb_api.core.base_entity
import jubladb_api.generated.entities.keys
{% if need_datetime_import %}
import datetime
{% endif %}
import typing

# @formatter:off

{% with class_name=entity.name_singular | snake_case_to_pascal_case %}

class {{ class_name }}(jubladb_api.core.base_entity.BaseEntity):
    def __init__(self,
                 id_: int,
                 {% for attr in entity.attributes %}
                 {{ attr.name }}: {{ attr.type_ | attribute_type_to_python_type }}{% if attr.optional %}|None{% endif %},
                 {% endfor %}

                 {% for rel in entity.relations %}
                 {{ rel.relation_name }}: {% if rel.to_many %} list[ {% endif %} jubladb_api.generated.entities.keys.{{ rel.related_type_singular | snake_case_to_pascal_case }}Key {% if rel.to_many %} ] {% endif %} | None,
                 {% endfor %}
                 ):
        super().__init__(id_)
        {% for attr in entity.attributes %}
        self._{{ attr.name }} = {{ attr.name }}{% endfor %}
        {% for rel in entity.relations %}
        self._{{ rel.relation_name }} = {{ rel.relation_name }}{% endfor %}


    {% for attr in entity.attributes %}
    @property
    def {{ attr.name }}(self) -> {{ attr.type_ | attribute_type_to_python_type }}{% if attr.optional %}|None{% endif %}:
        return self._{{ attr.name }}
    {% endfor %}

    {% for rel in entity.relations %}
    @property
    def {{ rel.relation_name }}(self) -> {% if rel.to_many %} list[ {% endif %} jubladb_api.generated.entities.keys.{{ rel.related_type_singular | snake_case_to_pascal_case }}Key {% if rel.to_many %} ] {% endif %}:
        if self._{{ rel.relation_name }} is None:
            raise ValueError("Relation {{ rel.relation_name }} is not included")
        return self._{{ rel.relation_name }}
    {% endfor %}

    @property
    def key(self) -> jubladb_api.generated.entities.keys.{{ class_name }}Key:
        return jubladb_api.generated.entities.keys.{{ class_name }}Key(self._id)

    @property
    def meta(self) -> jubladb_api.core.metamodel_classes.Entity:
        return jubladb_api.generated.metamodel.ENTITIES["{{ entity.name_singular }}"]

    def is_relation_loaded(self,
                           {% if entity.relations|length > 0 %}
                           relation_name: typing.Literal[{% for rel in entity.relations %}"{{ rel.relation_name }}", {% endfor %}],
                           {% else %}
                           relation_name: typing.Never,
                           {% endif %}
                           ) -> bool:
        {% if entity.relations|length > 0 %}
        {% for rel in entity.relations %}
        {% if loop.first %}if{% else %}elif{% endif %} relation_name == "{{ rel.relation_name }}":
            return self._{{ rel.relation_name }} is not None
        {% endfor %}
        else:
            raise ValueError(f"relation {relation_name} does not exist on {{ entity.name_singular }}")
        {% else %}
        raise ValueError("no relations defined on {{ entity.name_singular }}")
        {% endif %}


    @classmethod
    def from_json(cls, json_data: dict):
        if json_data.get("type", None) != "{{ entity.name_plural }}":
            raise ValueError("Invalid data type")
        return cls(
            id_=int(json_data["id"]),
            {% for attr in entity.attributes %}
            {% if attr.optional %}
            {{ attr.name }}={{ attr.type_ | attribute_type_python_constructor }}(json_data["attributes"]["{{ attr.name }}"]) if json_data["attributes"].get("{{ attr.name }}", None) is not None else None,
            {% else %}
            {{ attr.name }}={{ attr.type_ | attribute_type_python_constructor }}(json_data["attributes"]["{{ attr.name }}"]),
            {% endif %}
            {% endfor %}
            {% for rel in entity.relations %}
            {% if rel.to_many %}
            {{ rel.relation_name }} = cls._create_many_relation_keys(json_data, "{{ rel.relation_name }}", "{{ rel.related_type_plural }}", jubladb_api.generated.entities.keys.{{ rel.related_type_singular | snake_case_to_pascal_case }}Key),
            {% else %}
            {{ rel.relation_name }} = cls._create_single_relation_key(json_data, "{{ rel.relation_name }}", "{{ rel.related_type_plural }}", jubladb_api.generated.entities.keys.{{ rel.related_type_singular | snake_case_to_pascal_case }}Key),
            {% endif %}
            {% endfor %}
        )
{% endwith %}
# @formatter:on